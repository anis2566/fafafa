generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Class {
  Two
  Three
  Four
  Five
  Six
  Seven
  Eight
  Nine
  Ten
  HscFirstYear
  HscSecondYear
}

enum CounterClass {
  Two
  Three
  Four
  Five
  Six
  Seven
  Eight
  Nine
  Ten
  HscFirstYear
  HscSecondYear
  Teacher
}

enum Shift {
  Morning
  Day
  Evening
  Night
}

enum Religion {
  Islam
  Hinduism
  Christianity
  Buddhism
  Other
}

enum Group {
  Science
  Humanities
  BusinessStudies
}

enum Nationality {
  Bangladeshi
  Foreigner
}

enum Gender {
  Male
  Female
  Other
}

enum PaymentStatus {
  Paid
  Unpaid
  NA
}

enum PaymentMethod {
  Cash
  MobileBanking
}

enum Month {
  January
  February
  March
  April
  May
  June
  July
  August
  September
  October
  November
  December
}

enum Day {
  Saturday
  Sunday
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
}

enum Role {
  User
  Teacher
  Management
  Accountant
  HR
  Admin
}

enum Status {
  Pending
  Active
  Suspended
}

enum RoomStatus {
  Active
  Deactive
}

enum HouseStatus {
  Active
  Deactive
}

enum Level {
  Primary
  Seconday
  HigherSecondary
}

enum Expenses {
  Marketing
  FoodCost
  PhoneCost
  ComputerAndPaper
  OthersCost
}

model User {
  id            String          @id @default(cuid())
  name          String?
  email         String          @unique
  password      String?         @db.Text
  emailVerified DateTime?
  image         String?
  role          Role            @default(User)
  status        Status          @default(Pending)

  accounts      Account[]
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([email, id])
}
 
model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
 
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  @@id([provider, providerAccountId])
}
 
model VerificationToken {
  identifier String
  token      String
  expires    DateTime
 
  @@id([identifier])
}
 

model Student {
  id            String          @id @default(cuid())
  session       Int
  studentId     Int
  name          String
  nameBangla    String
  fName         String
  mName         String
  gender        Gender
  dob           DateTime
  nationality   Nationality
  religion      Religion
  imageUrl      String

  school        String
  class         Class
  section       String?
  shift         Shift?
  group         Group?
  roll          Int

  fPhone        String
  mPhone        String

  presentHouseNo      String
  presentMoholla      String
  presentPost         String
  presentThana        String
  permanentVillage    String
  permanentPost       String
  permanentThana      String
  permanentDistrict   String
  isPresent           Boolean     @default(true)

  admissionFee        Int
  monthlyFee          Int

  batchId             String?
  batch               Batch?     @relation(fields: [batchId], references: [id])

  admissionPayment   AdmissionPayment?
  payments           MonthlyPayment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
}


model Counter {
  id            String          @id @default(cuid())
  class         CounterClass
  count         Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, class])
}


model AdmissionFee {
  id            String          @id @default(cuid())
  class         Class
  amount         Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, class])
}


model MonthlyFee {
  id            String          @id @default(cuid())
  class         Class
  amount         Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, class])
}


model AdmissionPayment {
  id            String          @id @default(cuid())
  amount        Int
  method        PaymentMethod
  status        PaymentStatus   @default(Unpaid)
  session       Int

  studentId     String @unique
  student       Student     @relation(fields: [studentId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, studentId])
}


model MonthlyPayment {
  id            String          @id @default(cuid())
  amount        Int
  session       Int
  month         Month
  class         Class
  method        PaymentMethod?
  status        PaymentStatus   @default(Unpaid)
  note          String?         @db.Text

  studentId     String
  student       Student     @relation(fields: [studentId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, studentId, month])
}


model TeacherPayment {
  id            String          @id @default(cuid())
  amount        Int
  level         Level

  teacherId     String
  teacher       Teacher          @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, teacherId])
}

model HousePayment {
  id            String          @id @default(cuid())
  houseName     String
  session       Int
  month         Month
  amount        Int
  method        PaymentMethod?
  note          String?         @db.Text

  houseId     String
  house       House     @relation(fields: [houseId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, houseId, month])
}


model Room {
  id            String          @id @default(cuid())
  name          Int
  capacity      Int
  status        RoomStatus      @default(Deactive) 
  availableTime String[]        @default([])
  bookTime      String[]        @default([])

  houseId       String
  house         House           @relation(fields: [houseId], references: [id], onDelete: Cascade)
  batches       Batch[]


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
}


model House {
  id            String          @id @default(cuid())
  name          String
  roomCount     Int
  status        HouseStatus      @default(Deactive) 

  rooms         Room[]
  payments      HousePayment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
}


model Batch {
  id            String          @id @default(cuid())
  name          String
  class         Class
  capacity      Int
  time          String[]
  level         Level

  roomId        String
  room          Room            @relation(fields: [roomId], references: [id], onDelete: Cascade)

  students      Student[]
  classes       BatchClass[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
}


model Subject {
  id            String          @id @default(cuid())
  name          String
  class         Class
  level         Level
  group         Group?

  classes       BatchClass[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
}


model Teacher {
  id            String          @id @default(cuid())
  session       Int
  teacherId     Int
  name          String
  fName         String
  mName         String
  dob           DateTime
  gender        Gender
  nationality   Nationality
  religion      Religion
  imageUrl      String

  presentHouseNo      String
  presentMoholla      String
  presentPost         String
  presentThana        String
  permanentVillage    String
  permanentPost       String
  permanentThana      String
  permanentDistrict   String

  phone         String
  altPhone      String?

  level         Level[]

  classes       BatchClass[]
  payments      TeacherPayment[]

  status         Status    @default(Active)
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
}


model BatchClass {
  id            String          @id @default(cuid())
  time          String[]
  day           Day[]

  subjectId     String
  subject       Subject         @relation(fields: [subjectId], references: [id])
  teacherId     String
  teacher       Teacher         @relation(fields: [teacherId], references: [id])
  batchId       String
  batch         Batch           @relation(fields: [batchId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id, teacherId, subjectId])
}


model Expense {
  id            String          @id @default(cuid())
  type          Expenses
  amount        Int
  month         Month
  session       Int
  note          String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([id])
}